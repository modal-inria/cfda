<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Categorical Functional Data Analysis • cfda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Categorical Functional Data Analysis">
<meta property="og:description" content="cfda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cfda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cfda.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/modal-inria/cfda/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cfda_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Categorical Functional Data Analysis</h1>
                        <h4 data-toc-skip class="author">Cristian Preda, Quentin Grimonprez</h4>
            
            <h4 data-toc-skip class="date">2022-02-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/modal-inria/cfda/blob/HEAD/vignettes/cfda.Rmd" class="external-link"><code>vignettes/cfda.Rmd</code></a></small>
      <div class="hidden name"><code>cfda.Rmd</code></div>

    </div>

    
    
<p>See <a href="https://www.mdpi.com/2227-7390/9/23/3074" class="external-link uri">https://www.mdpi.com/2227-7390/9/23/3074</a> for more details about the mathematical background and an overview of the package.</p>
<div class="section level2">
<h2 id="dataset-simulation">Dataset Simulation<a class="anchor" aria-label="anchor" href="#dataset-simulation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modal-inria.github.io/cfda/">cfda</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></code></pre></div>
<p>We simulate the Jukes Cantor model of nucleotide replacement.</p>
<p>Denote the set of nucleotides: <span class="math inline">\(E = \{A, T, G, C\}\)</span>. A DNA sequence is seen as a string of nucleotides: <code>ATGCATTAC</code>.</p>
<p>Each  in the sequence is subject to mutation over time.</p>
<p>In the Jukes-Cantor model (1969), each site is a Markovian jump process with continuous time having as generator:</p>
<p><span class="math display">\[ Q = \ \ \ \begin{array}{c|cccc}
&amp;A&amp;T&amp;G&amp;C \\ \hline
A&amp;-3\alpha&amp;\alpha&amp;\alpha&amp;\alpha\\ 
T&amp;\alpha&amp;-3\alpha&amp;\alpha&amp;\alpha\\ 
G&amp;\alpha&amp;\alpha&amp;-3\alpha&amp;\alpha\\
C&amp;\alpha&amp;\alpha&amp;\alpha&amp;-3\alpha\\ \hline
\end{array}\]</span></p>
<p>for some <span class="math inline">\(\alpha &gt;0\)</span>.</p>
<p>Let assume that the process is observed over the period <span class="math inline">\([0,T_{\max}]\)</span> in <span class="math inline">\(n\)</span> sites with the nucleotide <span class="math inline">\(A\)</span> at time <span class="math inline">\(t=0\)</span>. In the following, nucleotides are recoded: <span class="math inline">\(A\leftrightarrow 1\)</span>, <span class="math inline">\(T\leftrightarrow 2\)</span>, <span class="math inline">\(G\leftrightarrow 3\)</span>, <span class="math inline">\(C\leftrightarrow 4\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">PJK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, ncol <span class="op">=</span> <span class="va">K</span>, nrow <span class="op">=</span> <span class="va">K</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="va">K</span><span class="op">)</span><span class="op">)</span>
<span class="va">lambda_PJK</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>

<span class="va">Tmax</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>

<span class="va">d_JK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_Markov.html">generate_Markov</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, K <span class="op">=</span> <span class="fl">4</span>, P <span class="op">=</span> <span class="va">PJK</span>, lambda <span class="op">=</span> <span class="va">lambda_PJK</span>, Tmax <span class="op">=</span> <span class="va">Tmax</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_JK</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    id      time state</span>
<span class="co">## 1   1 0.0000000     A</span>
<span class="co">## 2   1 0.1983368     G</span>
<span class="co">## 3   1 0.2365287     T</span>
<span class="co">## 4   1 1.7001558     G</span>
<span class="co">## 5   1 2.1102854     A</span>
<span class="co">## 6   1 2.5485099     T</span>
<span class="co">## 7   1 3.2633724     G</span>
<span class="co">## 8   1 3.3448084     A</span>
<span class="co">## 9   1 3.4654739     T</span>
<span class="co">## 10  1 4.9614496     C</span></code></pre>
<p>The dataset is a data.frame with 3 columns: <code>id</code>, <code>time</code>, <code>state</code>. <code>id</code> contains the id of the different individuals (usually integers). <code>time</code> contains the time values at which a change occurs, note that for each individual, time values are ordered and start at 0. <code>state</code> contains the state that appears at the given time, state must be characters, factors, integers. This data format is used by the most part of cfda’s functions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summary_cfd.html">summary_cfd</a></span><span class="op">(</span><span class="va">d_JK</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Number of rows: 1082 </span>
<span class="co">## Number of individuals: 100 </span>
<span class="co">## Time Range: 0 - 9.993531 </span>
<span class="co">## Same time start value for all ids: TRUE </span>
<span class="co">## Same time end value for all ids: FALSE </span>
<span class="co">## Number of states: 4 </span>
<span class="co">## States:</span>
<span class="co">##   A, C, G, T</span>
<span class="co">## Number of individuals visiting each state:</span>
<span class="co">##   A   C   G   T </span>
<span class="co">## 100  98  97  92</span></code></pre>
<p>We can compute the duration of each trajectory.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_duration.html">compute_duration</a></span><span class="op">(</span><span class="va">d_JK</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        1        2        3        4        5        6 </span>
<span class="co">## 9.976904 7.812600 8.871661 8.357921 9.650790 9.993531</span></code></pre>
<p>All individuals has a different length. The computation of an optimal encoding requires that the end time of each individual is the same (<span class="math inline">\(T_{\max}\)</span>), this can be done with the following function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d_JKT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cut_data.html">cut_data</a></span><span class="op">(</span><span class="va">d_JK</span>, Tmax <span class="op">=</span> <span class="va">Tmax</span><span class="op">)</span></code></pre></div>
<p>Individuals can be plotted:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotData.html">plotData</a></span><span class="op">(</span><span class="va">d_JKT</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/plot-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="basic-statistics">Basic statistics<a class="anchor" aria-label="anchor" href="#basic-statistics"></a>
</h2>
<p>Generally, in categorical functional data analysis, the following basic statistics are computed.</p>
<div class="section level3">
<h3 id="time-spent-in-each-state-over-a-period-of-length-t_max">Time spent in each state over a period of length <span class="math inline">\(T_{\max}\)</span>:<a class="anchor" aria-label="anchor" href="#time-spent-in-each-state-over-a-period-of-length-t_max"></a>
</h3>
<p>For each individual, the time spent in each of the <span class="math inline">\(K\)</span> states is computed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">timeSpent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_time_spent.html">compute_time_spent</a></span><span class="op">(</span><span class="va">d_JKT</span><span class="op">)</span>
<span class="va">timeSpent</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></code></pre></div>
<pre><code><span class="co">##           A         C        G        T</span>
<span class="co">## 1  2.827888 0.7229735 1.929005 4.520133</span>
<span class="co">## 2  3.951755 0.3545537 1.769637 3.924055</span>
<span class="co">## 3  1.958321 1.1951070 6.846572 0.000000</span>
<span class="co">## 4  4.718945 2.0622661 2.005165 1.213624</span>
<span class="co">## 5  3.200914 0.1618662 2.296325 4.340895</span>
<span class="co">## 6  4.214955 1.2124305 2.295326 2.277289</span>
<span class="co">## 7  2.757877 4.3517045 1.038824 1.851595</span>
<span class="co">## 8  3.826478 2.1324087 4.041113 0.000000</span>
<span class="co">## 9  1.687807 2.7519813 1.208147 4.352065</span>
<span class="co">## 10 4.788120 1.2389632 3.972917 0.000000</span></code></pre>
<p>The results can be plotted:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">timeSpent</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="number-of-jumps-in-0t_max">Number of jumps in <span class="math inline">\([0,T_{\max}]\)</span>:<a class="anchor" aria-label="anchor" href="#number-of-jumps-in-0t_max"></a>
</h3>
<p>For each individual, the number of jumps occurring in <span class="math inline">\([0,T_{\max}]\)</span> is computed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nJump</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_number_jumps.html">compute_number_jumps</a></span><span class="op">(</span><span class="va">d_JK</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nJump</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  1  2  3  4  5  6 </span>
<span class="co">## 17  9  3 13 10 13</span></code></pre>
<p>The results can be plotted:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">nJump</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="probabilities-to-be-in-some-state-x-at-time-t-p_xt">Probabilities to be in some state <span class="math inline">\(x\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(p_{x}(t)\)</span>:<a class="anchor" aria-label="anchor" href="#probabilities-to-be-in-some-state-x-at-time-t-p_xt"></a>
</h3>
<p>An other interesting statistic is the evolution of the probability to be in each state.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pt_evol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_pt.html">estimate_pt</a></span><span class="op">(</span><span class="va">d_JKT</span><span class="op">)</span>
<span class="va">pt_evol</span><span class="op">$</span><span class="va">pt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##   0 0.008 0.038 0.039 0.045 0.058 0.058 0.062 0.07 0.078</span>
<span class="co">## A 1  0.99  0.98  0.97  0.96  0.95  0.94  0.93 0.92  0.91</span>
<span class="co">## C 0  0.01  0.01  0.01  0.01  0.01  0.02  0.02 0.03  0.04</span>
<span class="co">## G 0  0.00  0.00  0.01  0.01  0.01  0.01  0.02 0.02  0.02</span>
<span class="co">## T 0  0.00  0.01  0.01  0.02  0.03  0.03  0.03 0.03  0.03</span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pt_evol</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.000000000 0.007897421 0.038151747 0.038873269 0.044793148 0.058217068</span></code></pre>
<p>The output is a list with two elements: <code>t</code> the different time values and <code>pt</code> a matrix where each row contains the probability to be in a given state for all the time values. The result can be plotted:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pt_evol</span>, ribbon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="transitions-in-0t_max">Transitions in <span class="math inline">\([0,T_{\max}]\)</span>:<a class="anchor" aria-label="anchor" href="#transitions-in-0t_max"></a>
</h3>
<p>The transitions between states can been studied by computing a frequency table counting the number of times each pair of states were observed in successive observation times.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/statetable.html">statetable</a></span><span class="op">(</span><span class="va">d_JK</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##     to</span>
<span class="co">## from   A   C   G   T</span>
<span class="co">##    A   0 110  85 105</span>
<span class="co">##    C  71   0  84  78</span>
<span class="co">##    G  72  65   0  78</span>
<span class="co">##    T  86  81  67   0</span></code></pre>
<p>Assuming that the data follows a Markov process, parameters <span class="math inline">\(P\)</span> (transition probability matrix) and <span class="math inline">\(\lambda\)</span> of the process can be estimated.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mark</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_Markov.html">estimate_Markov</a></span><span class="op">(</span><span class="va">d_JK</span><span class="op">)</span>
<span class="va">mark</span></code></pre></div>
<pre><code><span class="co">## $P</span>
<span class="co">##     to</span>
<span class="co">## from         A         C         G         T</span>
<span class="co">##    A 0.0000000 0.3666667 0.2833333 0.3500000</span>
<span class="co">##    C 0.3047210 0.0000000 0.3605150 0.3347639</span>
<span class="co">##    G 0.3348837 0.3023256 0.0000000 0.3627907</span>
<span class="co">##    T 0.3675214 0.3461538 0.2863248 0.0000000</span>
<span class="co">## </span>
<span class="co">## $lambda</span>
<span class="co">##        A        C        G        T </span>
<span class="co">## 1.062606 1.086185 1.079873 1.123472 </span>
<span class="co">## </span>
<span class="co">## attr(,"class")</span>
<span class="co">## [1] "Markov"</span></code></pre>
<p>The estimated parameters are closed to the ones used. The results can be plotted through a transition graph where each node corresponds to a state with the mean time spent within (corresponding to <span class="math inline">\(1/\lambda\)</span>) and arrows correspond to transition probabilities between states.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mark</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="encoding">Encoding<a class="anchor" aria-label="anchor" href="#encoding"></a>
</h2>
<div class="section level3">
<h3 id="concept">Concept<a class="anchor" aria-label="anchor" href="#concept"></a>
</h3>
<p><span class="math inline">\(X\)</span> is a continuous stochastic process with jumps. We define categorical functional data as a set of sample paths of <span class="math inline">\(X\)</span>.</p>
<p><strong>cfda</strong> is seen as an extension of the multiple correspondence analysis to a stochastic process.</p>
<p>The idea is to find a scalar real random variable <span class="math inline">\(z \in L_2(\Omega)\)</span> that is the <em>most correlated</em> to <span class="math inline">\({X} = \{X_{t}\ : \ t\in [0,T_{\max}]\}\)</span>.</p>
</div>
<div class="section level3">
<h3 id="mathematical-background">Mathematical Background<a class="anchor" aria-label="anchor" href="#mathematical-background"></a>
</h3>
<p>For a fixed <span class="math inline">\(t\in [0,T_{\max}]\)</span>, let <span class="math inline">\(E^{t}\)</span> the projection operator, <span class="math display">\[E^{t}(z) = \mathbb{E}(z|X_{t}) = \sum_{x\in S}{\mathbb{E}(z|X_t=x) \mathbf{1}_{X_t=x}}\]</span> Then, the correlation coefficient between <span class="math inline">\(z\)</span> and <span class="math inline">\(X_{t}\)</span> is: <span class="math display">\[\eta^{2}(z, X_{t}) = \frac{var(\mathbb{E}(z|X_{t}))}{var(z)}\]</span></p>
<p>For <span class="math inline">\(t, s \in [0,T_{\max}]\)</span>, the <em>(simple) correspondence analysis</em> looks for <span class="math inline">\(z\)</span> such that it maximizes <span class="math display">\[\displaystyle\frac{1}{2}\left(\eta^{2}(z, X_{t})+\eta^{2}(z, X_{s})\right)\]</span><br>
and the solution is:</p>
<p><span class="math display">\[(E^{t}+E^{s})z = \lambda z\]</span> <span class="math inline">\(z\)</span> is called a <em>principal component</em>.</p>
<p>As an extension, the <em>functional correspondence analysis</em> is defined as the solution of the optimization problem:</p>
<p><span class="math display">\[ \arg\max_{z}\displaystyle\frac{1}{T_{max}}\int_{0}^{T_{max}}\eta^{2}(z, X_{t})dt\]</span> Solution: <span class="math display">\[\int_{0}^{T_{max}}E^{s}z\ ds = \lambda z\]</span></p>
<p>Denote <span class="math inline">\(\xi_t = E^{t}z\)</span>,</p>
<p><span class="math display">\[\int_0^{T_{\max}}K(t,s)\xi_s\ ds = \lambda \xi_t, \ \ \ \ \mbox{with}\ K(s,t) = E^tE^s. \]</span></p>
<p>It follows that,<br><span class="math display">\[\xi_{t} = \sum_{x\in S}a_{x}(t)\mathbf{1}_{X_t=x}\]</span> with <span class="math inline">\(a_x(t) =\mathbb{E}(z|X_t= x), \ \ \forall x \in S\)</span>.</p>
<p>For each <span class="math inline">\(x\in S\)</span>, the functions <span class="math inline">\(a_x: [0,T_{\max}|\rightarrow \mathbb{R}\)</span> are called <em>optimal encoding</em> of the state <span class="math inline">\(x\)</span>.</p>
<p>The eigenvalue problem becomes in terms of encodings:</p>
<p><span class="math display">\[\lambda a_x(t) = \sum_{y\in S}\displaystyle\int_{0}^{T_{\max}}\frac{p_{x,y}(t,s)}{p_x(t)}a_y(s)ds, \ \ \ \ \ \forall x \in S, \forall t\in [0,T_{\max}], \]</span> where<span class="math inline">\(p_{x,y}(t,s) = \mathbb{P}(X_t=x, X_s=y)\)</span> and <span class="math inline">\(p_x(t)= \mathbb{P}(X_t=x)\)</span>.</p>
<p>Under general conditions (continuity in probability of <span class="math inline">\(X\)</span>), there exists <span class="math inline">\(\{\lambda_i\}_{i\geq1}\)</span> positive eigen-values and <span class="math inline">\(\{a_x^i\}_{i\geq 1}\)</span> eigen-functions.</p>
<p>The following expansion formula holds (Mercer thm.):</p>
<p><span class="math display">\[p_{x,y}(t,s) = p_x(t)p_y(s)\sum_{i\geq 1}\lambda_{i}a^i_x(t)a^i_y(s)\]</span> For <span class="math inline">\(x=y\)</span>, one obtains:</p>
<p><span class="math display">\[p_x(t) =\displaystyle\frac{1}{\displaystyle\sum_{i\geq 1}\lambda_{i}a^i_x(t)a^i_y(s)}\]</span></p>
<p>We are interested in approximating the encoding functions, <span class="math inline">\(a_x\)</span>, by</p>
<p><span class="math display">\[a_{x} \approx \sum_{i=1}^m \alpha_{x,i}\phi_i, \]</span> where <span class="math inline">\(\mathbf{\alpha_x} = (\alpha_{x,1}, \ldots, \alpha_{x,m}) \in \mathbb{R}^m\)</span> are the expansion coefficients onto a basis of functions defined on <span class="math inline">\([0,T]\)</span>, <span class="math inline">\(\{\phi_1, \ldots, \phi_m\}\)</span>, <span class="math inline">\(m \geq 1\)</span>.</p>
<p>The main result (Deville, 1982) is that <span class="math inline">\(\alpha = (\alpha_{1}, \ldots, \alpha_{K}) \in \mathbb{R}^{Km}\)</span> is the solution of the following eigen-value problem:</p>
<p><span class="math display">\[F^{-1}G\alpha = \lambda\alpha, \]</span> where <span class="math inline">\(G\)</span> and <span class="math inline">\(F\)</span> the matrix defined by: <span class="math display">\[G = cov(\{V_{(x,i)}\}_{x\in S; i=1:m }),\]</span> <span class="math display">\[F = \mathbb{E}\left(\{F_{(x,i),(y,j)}\}_{x,y\in S ; i,j=1:m}\right)\]</span> with the random variables <span class="math inline">\(V_{(x,i)}\)</span> and <span class="math inline">\(F_{(x,i),(x,j)}\)</span> defined by: <span class="math display">\[V_{(x,i)} = \int_{0}^{T_{\max}}\phi_i(t)\mathbf{1}_xdt \ \ \ \ \mbox{and}\ \ \ \ 
F_{(x,i), (y,j)} = \int_{0}^{T_{\max}}\phi_i(t)\phi_{j}(t)\mathbf{1}_x\mathbf{1}_y dt\]</span></p>
</div>
<div class="section level3">
<h3 id="application">Application<a class="anchor" aria-label="anchor" href="#application"></a>
</h3>
<p>Firstly, a basis of functions must be defined. We choose a B-splines basis of order 4.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fda/man/create.bspline.basis.html" class="external-link">create.bspline.basis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">Tmax</span><span class="op">)</span>, nbasis <span class="op">=</span> <span class="va">m</span>, norder <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>The optimal encoding is computed using:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fmca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_optimal_encoding.html">compute_optimal_encoding</a></span><span class="op">(</span><span class="va">d_JKT</span>, <span class="va">b</span>, nCores <span class="op">=</span> <span class="fl">2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fmca</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## #### FMCA</span>
<span class="co">## </span>
<span class="co">## ## Data </span>
<span class="co">## Number of individuals: 100 </span>
<span class="co">## Number of states: 4 </span>
<span class="co">## Time Range: 0 to 10 </span>
<span class="co">## States:  A C G T </span>
<span class="co">## </span>
<span class="co">## ## Basis </span>
<span class="co">## Type: bspline </span>
<span class="co">## Number of basis functions: 10 </span>
<span class="co">## </span>
<span class="co">## ## Outputs</span>
<span class="co">## Eigenvalues:</span>
<span class="co">##   1.94391 1.826387 1.580183 1.444652 1.343374 1.250424 </span>
<span class="co">## </span>
<span class="co">## Explained variance:</span>
<span class="co">##   0.093 0.181 0.256 0.325 0.39 0.45 </span>
<span class="co">## </span>
<span class="co">## Optimal encoding:</span>
<span class="co">##                 A          C          G            T</span>
<span class="co">## [1,]  0.002527816  0.6581468 -0.3285742 -0.002813819</span>
<span class="co">## [2,] -0.017726679 -0.3705776  0.3315846 -0.025042589</span>
<span class="co">## [3,] -0.225499860 -0.6291487  0.6640907  0.944240906</span>
<span class="co">## [4,] -0.399692155  0.5459657 -0.3712249 -0.182539384</span>
<span class="co">## [5,]  0.351928506  0.1955320 -0.7963197  0.291925346</span>
<span class="co">## [6,]  0.226710987  0.5287919 -0.8474339 -0.085294795</span>
<span class="co">## </span>
<span class="co">## Principal components:</span>
<span class="co">##          [,1]       [,2]       [,3]       [,4]        [,5]       [,6]</span>
<span class="co">## 1  0.49121450 -0.7761565 -2.2237978  0.8687437  0.20384095  0.4283276</span>
<span class="co">## 2  0.80112812 -0.9389699 -1.9379884  0.1778935  0.01221841 -0.7867856</span>
<span class="co">## 3 -4.05767245  0.3735209  0.6378840  0.4504148  0.45332552 -0.7901623</span>
<span class="co">## 4  0.88436329  0.2856844 -0.7993695 -1.6531371  1.23759838  0.9458713</span>
<span class="co">## 5  0.76235790 -2.3636970 -1.6430662  0.4241371 -0.56541361 -0.1747624</span>
<span class="co">## 6 -0.06611053  1.1208777 -1.5759303 -0.5073735 -0.73253829 -1.7198606</span>
<span class="co">## </span>
<span class="co">## Total elapsed time: 94.814 s</span></code></pre>
<p>By default this function computes bootstrap estimates of the encoding functions in order to have a confidence interval. This is controlled by the <code>computeCI</code> arguments. The output is a list containing the different elements computed during the process: <code>eigenvalues</code>, <code>pc</code>, <code>alpha</code>, <code>F</code>, <code>G</code>, <code>V</code> and <code>basisobj</code>. Note that <code>alpha</code>contains the coefficients of the different encoding functions and <code>pc</code>the principal components. These components can be used with classical statistic methods (k-means, regression…).</p>
<p>The eigenvalues can be computed using:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotEigenvalues.html">plotEigenvalues</a></span><span class="op">(</span><span class="va">fmca</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The first encoding function coefficients <span class="math inline">\(\alpha\)</span>’s:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fmca</span><span class="op">$</span><span class="va">alpha</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                  A          C           G            T</span>
<span class="co">##  [1,]  0.002527816  0.6581468 -0.32857421 -0.002813819</span>
<span class="co">##  [2,] -0.017726679 -0.3705776  0.33158464 -0.025042589</span>
<span class="co">##  [3,] -0.225499860 -0.6291487  0.66409074  0.944240906</span>
<span class="co">##  [4,] -0.399692155  0.5459657 -0.37122487 -0.182539384</span>
<span class="co">##  [5,]  0.351928506  0.1955320 -0.79631965  0.291925346</span>
<span class="co">##  [6,]  0.226710987  0.5287919 -0.84743389 -0.085294795</span>
<span class="co">##  [7,] -0.152761503  0.3105041 -0.31618292  0.277709736</span>
<span class="co">##  [8,]  0.336894982 -0.3244686 -0.48491253  0.661191654</span>
<span class="co">##  [9,] -0.473977007  0.1768115 -0.02103771  0.305263785</span>
<span class="co">## [10,] -0.128365002 -0.1472297 -0.19896052  0.515596657</span></code></pre>
<p>The resulting encoding can be plotted:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fmca</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: Removed 3 row(s) containing missing values (geom_path).</span></code></pre>
<p><img src="cfda_files/figure-html/unnamed-chunk-15-1.png" width="480" style="display: block; margin: auto;"> or extracted as a <em>fd</em> object (or matrix):</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">encoding</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_encoding.html">get_encoding</a></span><span class="op">(</span><span class="va">fmca</span>, fdObject <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>By default, it plots (and returns) the first encoding functions. Other encoding can be accessed with the <code>harm</code> argument.</p>
<p>A confidence interval can be plotted using the <code>addCI</code> argument:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fmca</span>, addCI <span class="op">=</span> <span class="cn">TRUE</span>, coeff <span class="op">=</span> <span class="fl">2</span>, states <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-17-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Plot the two first components:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotComponent.html">plotComponent</a></span><span class="op">(</span><span class="va">fmca</span>, comp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, addNames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-18-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Cristian Preda, Quentin Grimonprez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
