<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Categorical Functional Data Analysis • cfda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Categorical Functional Data Analysis">
<meta property="og:description" content="cfda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cfda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/cfda.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/modal-inria/cfda/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cfda_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Categorical Functional Data Analysis</h1>
                        <h4 class="author">Cristian Preda, Quentin Grimonprez</h4>
            
            <h4 class="date">2020-10-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/modal-inria/cfda/blob/master/vignettes/cfda.Rmd"><code>vignettes/cfda.Rmd</code></a></small>
      <div class="hidden name"><code>cfda.Rmd</code></div>

    </div>

    
    
<div id="dataset-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset-simulation" class="anchor"></a>Dataset Simulation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">cfda</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">42</span>)
</pre></div>
<p>We simulate the Jukes Cantor model of nucleotide replacement.</p>
<p>Denote the set of nucleotides: <span class="math inline">\(E = \{A, T, G, C\}\)</span>. A DNA sequence is seen as a string of nucleotides: <code>ATGCATTAC</code>.</p>
<p>Each  in the sequence is subject to mutation over time.</p>
<p>In the Jukes-Cantor model (1969), each site is a Markovian jump process with continuous time having as generator:</p>
<p><span class="math display">\[ Q = \ \ \ \begin{array}{c|cccc}
&amp;A&amp;T&amp;G&amp;C \\ \hline
A&amp;-3\alpha&amp;\alpha&amp;\alpha&amp;\alpha\\ 
T&amp;\alpha&amp;-3\alpha&amp;\alpha&amp;\alpha\\ 
G&amp;\alpha&amp;\alpha&amp;-3\alpha&amp;\alpha\\
C&amp;\alpha&amp;\alpha&amp;\alpha&amp;-3\alpha\\ \hline
\end{array}\]</span></p>
<p>for some <span class="math inline">\(\alpha &gt;0\)</span>.</p>
<p>Let assume that the process is observed over the period <span class="math inline">\([0,T_{\max}]\)</span> in <span class="math inline">\(n\)</span> sites with the nucleotide <span class="math inline">\(A\)</span> at time <span class="math inline">\(t=0\)</span>. In the following, nucleotides are recoded: <span class="math inline">\(A\leftrightarrow 1\)</span>, <span class="math inline">\(T\leftrightarrow 2\)</span>, <span class="math inline">\(G\leftrightarrow 3\)</span>, <span class="math inline">\(C\leftrightarrow 4\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">K</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="kw">PJK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, ncol = <span class="kw">K</span>, nrow = <span class="kw">K</span>) <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="kw">K</span>))
<span class="kw">lambda_PJK</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>)

<span class="kw">Tmax</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="kw">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>

<span class="kw">d_JK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_Markov.html">generate_Markov</a></span>(n = <span class="kw">n</span>, K = <span class="fl">4</span>, P = <span class="kw">PJK</span>, lambda = <span class="kw">lambda_PJK</span>, Tmax = <span class="kw">Tmax</span>, labels = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>))

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">d_JK</span>, <span class="fl">10</span>)
</pre></div>
<pre><code>##    id      time state
## 1   1 0.0000000     A
## 2   1 0.1983368     G
## 3   1 0.2365287     T
## 4   1 1.7001558     G
## 5   1 2.1102854     A
## 6   1 2.5485099     T
## 7   1 3.2633724     G
## 8   1 3.3448084     A
## 9   1 3.4654739     T
## 10  1 4.9614496     C</code></pre>
<p>The dataset is a data.frame with 3 columns: <code>id</code>, <code>time</code>, <code>state</code>. <code>id</code> contains the id of the different individuals (usually integers). <code>time</code> contains the time values at which a change occurs, note that for each individual, time values are ordered and start at 0. <code>state</code> contains the state that appears at the given time, state must be characters, factors, integers. This data format is used by the most part of cfda’s functions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="../reference/summary_cfd.html">summary_cfd</a></span>(<span class="kw">d_JK</span>)
</pre></div>
<pre><code>## Number of rows: 1082 
## Number of individuals: 100 
## Time Range: 0 - 9.993531 
## Same time start value for all ids: TRUE 
## Same time end value for all ids: FALSE 
## Number of states: 4 
## States:
##   A, C, G, T
## Number of individuals visiting each state:
##   A   C   G   T 
## 100  98  97  92</code></pre>
<p>We can compute the duration of each trajectory.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_duration.html">compute_duration</a></span>(<span class="kw">d_JK</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">duration</span>)
</pre></div>
<pre><code>##        1        2        3        4        5        6 
## 9.976904 7.812600 8.871661 8.357921 9.650790 9.993531</code></pre>
<p>All individuals has a different length. The computation of an optimal encoding requires that the end time of each individual is the same (<span class="math inline">\(T_{\max}\)</span>), this can be done with the following function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">d_JKT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cut_data.html">cut_data</a></span>(<span class="kw">d_JK</span>, Tmax = <span class="kw">Tmax</span>)
</pre></div>
<p>Individuals can be plotted:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="../reference/plotData.html">plotData</a></span>(<span class="kw">d_JKT</span>)
</pre></div>
<p><img src="cfda_files/figure-html/plot-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="basic-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-statistics" class="anchor"></a>Basic statistics</h2>
<p>Generally, in categorical functional data analysis, the following basic statistics are computed.</p>
<div id="time-spent-in-each-state-over-a-period-of-length-t_max" class="section level3">
<h3 class="hasAnchor">
<a href="#time-spent-in-each-state-over-a-period-of-length-t_max" class="anchor"></a>Time spent in each state over a period of length <span class="math inline">\(T_{\max}\)</span>:</h3>
<p>For each individual, the time spent in each of the <span class="math inline">\(K\)</span> states is computed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">timeSpent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_time_spent.html">compute_time_spent</a></span>(<span class="kw">d_JKT</span>)
<span class="kw">timeSpent</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,]
</pre></div>
<pre><code>##           A         C        G        T
## 1  2.827888 0.7229735 1.929005 4.520133
## 2  3.951755 0.3545537 1.769637 3.924055
## 3  1.958321 1.1951070 6.846572 0.000000
## 4  4.718945 2.0622661 2.005165 1.213624
## 5  3.200914 0.1618662 2.296325 4.340895
## 6  4.214955 1.2124305 2.295326 2.277289
## 7  2.757877 4.3517045 1.038824 1.851595
## 8  3.826478 2.1324087 4.041113 0.000000
## 9  1.687807 2.7519813 1.208147 4.352065
## 10 4.788120 1.2389632 3.972917 0.000000</code></pre>
<p>The results can be plotted:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(<span class="kw">timeSpent</span>)
</pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="number-of-jumps-in-0t_max" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-jumps-in-0t_max" class="anchor"></a>Number of jumps in <span class="math inline">\([0,T_{\max}]\)</span>:</h3>
<p>For each individual, the number of jumps occurring in <span class="math inline">\([0,T_{\max}]\)</span> is computed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">nJump</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_number_jumps.html">compute_number_jumps</a></span>(<span class="kw">d_JK</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">nJump</span>)
</pre></div>
<pre><code>##  1  2  3  4  5  6 
## 17  9  3 13 10 13</code></pre>
<p>The results can be plotted:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="kw">nJump</span>)
</pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="probabilities-to-be-in-some-state-x-at-time-t-p_xt" class="section level3">
<h3 class="hasAnchor">
<a href="#probabilities-to-be-in-some-state-x-at-time-t-p_xt" class="anchor"></a>Probabilities to be in some state <span class="math inline">\(x\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(p_{x}(t)\)</span>:</h3>
<p>An other interesting statistic is the evolution of the probability to be in each state.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">pt_evol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_pt.html">estimate_pt</a></span>(<span class="kw">d_JKT</span>)
<span class="kw">pt_evol</span><span class="op">$</span><span class="kw">pt</span>[<span class="fl">1</span><span class="op">:</span><span class="kw">K</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>]
</pre></div>
<pre><code>##   0 0.008 0.038 0.039 0.045 0.058 0.058 0.062 0.07 0.078
## A 1  0.99  0.98  0.97  0.96  0.95  0.94  0.93 0.92  0.91
## C 0  0.01  0.01  0.01  0.01  0.01  0.02  0.02 0.03  0.04
## G 0  0.00  0.00  0.01  0.01  0.01  0.01  0.02 0.02  0.02
## T 0  0.00  0.01  0.01  0.02  0.03  0.03  0.03 0.03  0.03</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">pt_evol</span><span class="op">$</span><span class="kw">t</span>)
</pre></div>
<pre><code>## [1] 0.000000000 0.007897421 0.038151747 0.038873269 0.044793148 0.058217068</code></pre>
<p>The output is a list with two elements: <code>t</code> the different time values and <code>pt</code> a matrix where each row contains the probability to be in a given state for all the time values. The result can be plotted:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">pt_evol</span>, ribbon = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="transitions-in-0t_max" class="section level3">
<h3 class="hasAnchor">
<a href="#transitions-in-0t_max" class="anchor"></a>Transitions in <span class="math inline">\([0,T_{\max}]\)</span>:</h3>
<p>The transitions between states can been studied by computing a frequency table counting the number of times each pair of states were observed in successive observation times.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
 <span class="fu"><a href="../reference/statetable.html">statetable</a></span>(<span class="kw">d_JK</span>)
</pre></div>
<pre><code>##     to
## from   A   C   G   T
##    A   0 110  85 105
##    C  71   0  84  78
##    G  72  65   0  78
##    T  86  81  67   0</code></pre>
<p>Assuming that the data follows a Markov process, parameters <span class="math inline">\(P\)</span> (transition probability matrix) and <span class="math inline">\(\lambda\)</span> of the process can be estimated.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">mark</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_Markov.html">estimate_Markov</a></span>(<span class="kw">d_JK</span>)
<span class="kw">mark</span>
</pre></div>
<pre><code>## $P
##     to
## from         A         C         G         T
##    A 0.0000000 0.3666667 0.2833333 0.3500000
##    C 0.3047210 0.0000000 0.3605150 0.3347639
##    G 0.3348837 0.3023256 0.0000000 0.3627907
##    T 0.3675214 0.3461538 0.2863248 0.0000000
## 
## $lambda
##        A        C        G        T 
## 1.062606 1.086185 1.079873 1.123472 
## 
## attr(,"class")
## [1] "Markov"</code></pre>
<p>The estimated parameters are closed to the ones used. The results can be plotted through a transition graph where each node corresponds to a state with the mean time spent within (corresponding to <span class="math inline">\(1/\lambda\)</span>) and arrows correspond to transition probabilities between states.</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">mark</span>)
</pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="encoding" class="section level2">
<h2 class="hasAnchor">
<a href="#encoding" class="anchor"></a>Encoding</h2>
<div id="concept" class="section level3">
<h3 class="hasAnchor">
<a href="#concept" class="anchor"></a>Concept</h3>
<p><span class="math inline">\(X\)</span> is a continuous stochastic process with jumps. We define categorical functional data as a set of sample paths of <span class="math inline">\(X\)</span>.</p>
<p><strong>cfda</strong> is seen as an extension of the multiple correspondence analysis to a stochastic process.</p>
<p>The idea is to find a scalar real random variable <span class="math inline">\(z \in L_2(\Omega)\)</span> that is the <em>most correlated</em> to <span class="math inline">\({X} = \{X_{t}\ : \ t\in [0,T_{\max}]\}\)</span>.</p>
</div>
<div id="mathematical-background" class="section level3">
<h3 class="hasAnchor">
<a href="#mathematical-background" class="anchor"></a>Mathematical Background</h3>
<p>For a fixed <span class="math inline">\(t\in [0,T_{\max}]\)</span>, let <span class="math inline">\(E^{t}\)</span> the projection operator, <span class="math display">\[E^{t}(z) = \mathbb{E}(z|X_{t}) = \sum_{x\in S}{\mathbb{E}(z|X_t=x) \mathbf{1}_{X_t=x}}\]</span> Then, the correlation coefficient between <span class="math inline">\(z\)</span> and <span class="math inline">\(X_{t}\)</span> is: <span class="math display">\[\eta^{2}(z, X_{t}) = \frac{var(\mathbb{E}(z|X_{t}))}{var(z)}\]</span></p>
<p>For <span class="math inline">\(t, s \in [0,T_{\max}]\)</span>, the <em>(simple) correspondence analysis</em> looks for <span class="math inline">\(z\)</span> such that it maximizes <span class="math display">\[\displaystyle\frac{1}{2}\left(\eta^{2}(z, X_{t})+\eta^{2}(z, X_{s})\right)\]</span><br>
and the solution is:</p>
<p><span class="math display">\[(E^{t}+E^{s})z = \lambda z\]</span> <span class="math inline">\(z\)</span> is called a <em>principal component</em>.</p>
<p>As an extension, the <em>functional correspondance analysis</em> is defined as the solution of the optimization problem:</p>
<p><span class="math display">\[ \arg\max_{z}\displaystyle\frac{1}{T_{max}}\int_{0}^{T_{max}}\eta^{2}(z, X_{t})dt\]</span> Solution: <span class="math display">\[\int_{0}^{T_{max}}E^{s}z\ ds = \lambda z\]</span></p>
<p>Denote <span class="math inline">\(\xi_t = E^{t}z\)</span>,</p>
<p><span class="math display">\[\int_0^{T_{\max}}K(t,s)\xi_s\ ds = \lambda \xi_t, \ \ \ \ \mbox{with}\ K(s,t) = E^tE^s. \]</span></p>
<p>It follows that,<br><span class="math display">\[\xi_{t} = \sum_{x\in S}a_{x}(t)\mathbf{1}_{X_t=x}\]</span> with <span class="math inline">\(a_x(t) =\mathbb{E}(z|X_t= x), \ \ \forall x \in S\)</span>.</p>
<p>For each <span class="math inline">\(x\in S\)</span>, the functions <span class="math inline">\(a_x: [0,T_{\max}|\rightarrow \mathbb{R}\)</span> are called <em>optimal encoding</em> of the state <span class="math inline">\(x\)</span>.</p>
<p>The eigenvalue problem becomes in terms of encodings:</p>
<p><span class="math display">\[\lambda a_x(t) = \sum_{y\in S}\displaystyle\int_{0}^{T_{\max}}\frac{p_{x,y}(t,s)}{p_x(t)}a_y(s)ds, \ \ \ \ \ \forall x \in S, \forall t\in [0,T_{\max}], \]</span> where<span class="math inline">\(p_{x,y}(t,s) = \mathbb{P}(X_t=x, X_s=y)\)</span> and <span class="math inline">\(p_x(t)= \mathbb{P}(X_t=x)\)</span>.</p>
<p>Under general conditions (continuity in probability of <span class="math inline">\(X\)</span>), there exists <span class="math inline">\(\{\lambda_i\}_{i\geq1}\)</span> positive eigen-values and <span class="math inline">\(\{a_x^i\}_{i\geq 1}\)</span> eigen-functions.</p>
<p>The folowing expansion formula holds (Mercer thm.):</p>
<p><span class="math display">\[p_{x,y}(t,s) = p_x(t)p_y(s)\sum_{i\geq 1}\lambda_{i}a^i_x(t)a^i_y(s)\]</span> For <span class="math inline">\(x=y\)</span>, one obtains:</p>
<p><span class="math display">\[p_x(t) =\displaystyle\frac{1}{\displaystyle\sum_{i\geq 1}\lambda_{i}a^i_x(t)a^i_y(s)}\]</span></p>
<p>We are interested in approximating the encoding functions, <span class="math inline">\(a_x\)</span>, by</p>
<p><span class="math display">\[a_{x} \approx \sum_{i=1}^m \alpha_{x,i}\phi_i, \]</span> where <span class="math inline">\(\mathbf{\alpha_x} = (\alpha_{x,1}, \ldots, \alpha_{x,m}) \in \mathbb{R}^m\)</span> are the expansion coefficients onto a basis of functions defined on <span class="math inline">\([0,T]\)</span>, <span class="math inline">\(\{\phi_1, \ldots, \phi_m\}\)</span>, <span class="math inline">\(m \geq 1\)</span>.</p>
<p>The main result (Deville, 1982) is that <span class="math inline">\(\alpha = (\alpha_{1}, \ldots, \alpha_{K}) \in \mathbb{R}^{Km}\)</span> is the solution of the following eigen-value problem:</p>
<p><span class="math display">\[F^{-1}G\alpha = \lambda\alpha, \]</span> where <span class="math inline">\(G\)</span> and <span class="math inline">\(F\)</span> the matrix defined by: <span class="math display">\[G = cov(\{V_{(x,i)}\}_{x\in S; i=1:m }),\]</span> <span class="math display">\[F = \mathbb{E}\left(\{F_{(x,i),(y,j)}\}_{x,y\in S ; i,j=1:m}\right)\]</span> with the random variables <span class="math inline">\(V_{(x,i)}\)</span> and <span class="math inline">\(F_{(x,i),(x,j)}\)</span> defined by: <span class="math display">\[V_{(x,i)} = \int_{0}^{T_{\max}}\phi_i(t)\mathbf{1}_xdt \ \ \ \ \mbox{and}\ \ \ \ 
F_{(x,i), (y,j)} = \int_{0}^{T_{\max}}\phi_i(t)\phi_{j}(t)\mathbf{1}_x\mathbf{1}_y dt\]</span></p>
</div>
<div id="application" class="section level3">
<h3 class="hasAnchor">
<a href="#application" class="anchor"></a>Application</h3>
<p>Firstly, a basis of functions must be defined. We choose a B-splines basis of order 4.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="kw">m</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="kw">b</span> <span class="op">&lt;-</span> <span class="fu">create.bspline.basis</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="kw">Tmax</span>), nbasis = <span class="kw">m</span>, norder = <span class="fl">4</span>)
</pre></div>
<p>The optimal encoding is computed using:</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="kw">fmca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_optimal_encoding.html">compute_optimal_encoding</a></span>(<span class="kw">d_JKT</span>, <span class="kw">b</span>, nCores = <span class="fl">2</span>, verbose = <span class="fl">FALSE</span>)
</pre></div>
<p>By default this function computes bootstrap estimates of the encoding functions in order to have a confidence interval. This is controlled by the <code>computeCI</code> arguments. The output is a list containing the different elements computed during the process: <code>eigenvalues</code>, <code>pc</code>, <code>alpha</code>, <code>F</code>, <code>G</code>, <code>V</code> and <code>basisobj</code>. Note that <code>alpha</code>contains the coefficients of the different encoding functions and <code>pc</code>the principal components. These components can be used with classical statistic methods (k-means, regression…).</p>
<p>The eigenvalues can be computed using:</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="fu"><a href="../reference/plotEigenvalues.html">plotEigenvalues</a></span>(<span class="kw">fmca</span>, cumulative = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The first encoding function coefficients <span class="math inline">\(\alpha\)</span>’s:</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw">fmca</span><span class="op">$</span><span class="kw">alpha</span>[[<span class="fl">1</span>]])
</pre></div>
<pre><code>##                  A          C           G            T
##  [1,]  0.002527816  0.6581468 -0.32857421 -0.002813819
##  [2,] -0.017726679 -0.3705776  0.33158464 -0.025042589
##  [3,] -0.225499860 -0.6291487  0.66409074  0.944240906
##  [4,] -0.399692155  0.5459657 -0.37122487 -0.182539384
##  [5,]  0.351928506  0.1955320 -0.79631965  0.291925346
##  [6,]  0.226710987  0.5287919 -0.84743389 -0.085294795
##  [7,] -0.152761503  0.3105041 -0.31618292  0.277709736
##  [8,]  0.336894982 -0.3244686 -0.48491253  0.661191654
##  [9,] -0.473977007  0.1768115 -0.02103771  0.305263785
## [10,] -0.128365002 -0.1472297 -0.19896052  0.515596657</code></pre>
<p>The resulting encoding can be plotted:</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fmca</span>)
</pre></div>
<pre><code>## Warning: Removed 3 row(s) containing missing values (geom_path).</code></pre>
<p><img src="cfda_files/figure-html/unnamed-chunk-15-1.png" width="480" style="display: block; margin: auto;"> or extracted as a <em>fd</em> object (or matrix):</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="kw">encoding</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_encoding.html">get_encoding</a></span>(<span class="kw">fmca</span>, fdObject = <span class="fl">TRUE</span>)
</pre></div>
<p>By default, it plots (and returns) the first encoding functions. Other encoding can be accessed with the <code>harm</code> argument.</p>
<p>A confidence interval can be plotted using the <code>addCI</code> argument:</p>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fmca</span>, addCI = <span class="fl">TRUE</span>, coeff = <span class="fl">2</span>, states = <span class="st">"A"</span>)
</pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-17-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Plot the two first components:</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="fu"><a href="../reference/plotComponent.html">plotComponent</a></span>(<span class="kw">fmca</span>, comp = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>), addNames = <span class="fl">FALSE</span>)
</pre></div>
<p><img src="cfda_files/figure-html/unnamed-chunk-18-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Cristian Preda, Quentin Grimonprez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
